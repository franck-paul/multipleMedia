"use strict";dotclear.ready((()=>{dotclear.mm_select=dotclear.getData("mm_select"),jsToolBar.prototype.elements.mm_select={type:"button",title:"Multiple image chooser",context:"post",icon:dotclear.mm_select.icon,fn:{},fncall:{},open_url:dotclear.mm_select.open_url,data:{},popup(){window.the_toolbar=this,this.elements.mm_select.data={},window.open(this.elements.mm_select.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.mm_select.fn.wiki=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.xhtml=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.wysiwyg=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.markdown=function(){this.elements.mm_select.popup.call(this)};const e=e=>{if(null===e||""===e)return"";e=e.toString();const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))},t=t=>{const l=e(t?.selection||t?.alt||""),s=!(!t?.description||!l.length)&&e(t.description);return{alt:l,legend:l!==s&&s,link:t?.link&&l.length}};jsToolBar.prototype.elements.mm_select.fncall.wiki=function(){const{data:l}=this.elements.mm_select;if(void 0===l||0===l.list.length)return;dotclear.mm_select.getInfos(l.path,l.list,l.pref,this,((l,s)=>{if(s.settings?.block){const e=s.settings.block+(s.settings?.class?` class="${s.settings?.class}"`:"");l.encloseSelection(`///html\n<${e}>\n///\n`,`///html\n</${s.settings.block}>\n///\n`)}Object.values(s.list).forEach((n=>{l.encloseSelection("","",(i=>{const c={left:"L",right:"R",center:"C"},o=t({selection:i,alt:n?.title,description:n?.description,link:s.settings?.link});let r=`((${l.stripBaseURL(n.src)}|${o.alt}`;if(s.settings.alignment in c?r+=`|${c[s.settings.alignment]}`:o.legend&&(r+="|"),o.legend&&(r+=`||${o.legend}`),r+="))",o.link){const t=dotclear.mm_select.img_link_title?`||${e(dotclear.mm_select.img_link_title)}`:"";return`[${r}|${l.stripBaseURL(n.url)}${t}]\n`}return`${r}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.fncall.xhtml=function(){const{data:l}=this.elements.mm_select;if(void 0===l||0===l.list.length)return;dotclear.mm_select.getInfos(l.path,l.list,l.pref,this,((l,s)=>{if(s.settings?.block){const e=s.settings.block+(s.settings?.class?` class="${s.settings?.class}"`:"");l.encloseSelection(`<${e}>\n`,`</${s.settings.block}>\n`)}Object.values(s.list).forEach((n=>{l.encloseSelection("","",(i=>{const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:i,alt:n?.title,description:n?.description,link:s.settings?.link});let r=`<img src="${l.stripBaseURL(n.src)}" alt="${o.alt}"`,a="<figure";const m=o.legend?`<figcaption>${o.legend}</figcaption>\n`:"";if(s.settings.alignment in c&&(o.legend?a=`${a} class="${c[s.settings.alignment]}"`:r=`${r} class="${c[s.settings.alignment]}"`),r=`${r}>`,a=`${a}>`,o.link){const t=dotclear.mm_select.img_link_title?`title="${e(dotclear.mm_select.img_link_title)}"`:"";r=`<a href="${l.stripBaseURL(n.url)}"${t}>${r}</a>`}return o.legend?`${a}\n${r}\n${m}</figure>\n`:`${r}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.fncall.wysiwyg=function(){const{data:l}=this.elements.mm_select;if(void 0===l||0===l.list.length)return;dotclear.mm_select.getInfos(l.path,l.list,l.pref,this,((l,s)=>{let n;s.settings?.block&&(n=l.iwin.document.createElement(s.settings.block),s.settings?.class&&n.setAttribute("class",s.settings?.class)),Object.values(s.list).reverse().forEach((i=>{if(null==i.src)return;const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:str,alt:i?.title,description:i?.description,link:s.settings?.link}),r=o.legend?l.iwin.document.createElement("figure"):null,a=l.iwin.document.createElement("img"),m=o.legend?r:a;if(s.settings.alignment in c&&m.classList.add(c[s.settings.alignment]),a.src=l.stripBaseURL(i.src),a.setAttribute("alt",o.alt),o.legend){const e=l.iwin.document.createElement("figcaption");e.appendChild(l.iwin.document.createTextNode(o.legend)),r.appendChild(a),r.appendChild(e)}if(o.link){const t=dotclear.mm_select.img_link_title?e(dotclear.mm_select.img_link_title):"",s=l.iwin.document.createElement("a");return s.href=l.stripBaseURL(i.url),s.setAttribute("title",t),s.appendChild(m),void(void 0===n?l.insertNode(s):n.insertNode(s))}void 0===n?l.insertNode(m):n.insertNode(m)})),void 0!==n&&l.insertNode(n)}))},jsToolBar.prototype.elements.mm_select.fncall.markdown=function(){const{data:l}=this.elements.mm_select;if(void 0===l||0===l.list.length)return;dotclear.mm_select.getInfos(l.path,l.list,l.pref,this,((l,s)=>{if(s.settings?.block){const e=s.settings.block+(s.settings?.class?` class="${s.settings?.class}"`:"");l.encloseSelection(`<${e}>\n`,`</${s.settings.block}>\n`)}Object.values(s.list).forEach((n=>{l.encloseSelection("","",(i=>{const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:i,alt:n?.title,description:n?.description,link:s.settings?.link});let r=`<img src="${l.stripBaseURL(n.src)}" alt="${o.alt}"`,a="<figure";const m=o.legend?`<figcaption>${o.legend}</figcaption>\n`:"";if(s.settings.alignment in c&&(o.legend?a=`${a} ${dotclear.mm_select.style.class?"class":"style"}="${c[s.settings.alignment]}"`:r=`${r} ${dotclear.mm_select.style.class?"class":"style"}="${c[s.settings.alignment]}"`),r=`${r}>`,a=`${a}>`,o.link){const t=dotclear.mm_select.img_link_title?e(dotclear.mm_select.img_link_title):"",s=t?`title="${t}"`:"";r=`<a href="${l.stripBaseURL(n.url)}"${s}>${r}</a>`}return o.legend?`${a}\n${r}\n${m}</figure>\n`:`${r}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.title=dotclear.mm_select.title,dotclear.mm_select.getInfos=(e,t,l,s,n)=>(t=JSON.stringify(t),l=JSON.stringify(l),dotclear.jsonServicesPost("getMediaInfos",(e=>{e.ret&&n(s,e.info)}),{path:e,list:t,pref:l}),null)}));
