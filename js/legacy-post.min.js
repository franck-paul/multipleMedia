"use strict";dotclear.ready(()=>{dotclear.mm_select=dotclear.getData("mm_select"),jsToolBar.prototype.elements.mmSpaceBefore={type:"space",format:{wysiwyg:!0,wiki:!0,xhtml:!0,markdown:!0}},jsToolBar.prototype.elements.mm_select={type:"button",title:"Multiple image chooser",context:"post",icon:dotclear.mm_select.icon,icon_dark:dotclear.mm_select.icon_dark,fn:{},fncall:{},open_url:dotclear.mm_select.open_url,data:{},popup(){window.the_toolbar=this,this.elements.mm_select.data={},window.open(this.elements.mm_select.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.mmSpaceAfter={type:"space",format:{wysiwyg:!0,wiki:!0,xhtml:!0,markdown:!0}},jsToolBar.prototype.elements.mm_select.fn.wiki=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.xhtml=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.wysiwyg=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.markdown=function(){this.elements.mm_select.popup.call(this)};const e=e=>{if(null===e||""===e)return"";const t=e.toString(),s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,e=>s[e])},t=t=>{const s=e(t?.selection||t?.alt||""),l=!(!t?.description||!s.length)&&e(t.description);return{alt:s,legend:s!==l&&l,link:t?.link&&s.length}};jsToolBar.prototype.elements.mm_select.fncall.wiki=function(){const{data:s}=this.elements.mm_select;if(void 0===s||0===s.list.length)return;dotclear.mm_select.getInfos(s.path,s.list,s.pref,this,(s,l)=>{if(l.settings?.block){const e=l.settings.block+(l.settings?.class?` class="${l.settings?.class}"`:"");s.encloseSelection(`///html\n<${e}>\n///\n`,`///html\n</${l.settings.block}>\n///\n`)}for(const n of Object.values(l.list))s.encloseSelection("","",i=>{const c={left:"L",right:"R",center:"C"},o=t({selection:i,alt:n?.title,description:n?.description,link:l.settings?.link});let r=`((${s.stripBaseURL(n.src)}|${o.alt}`;if(l.settings.alignment in c?r+=`|${c[l.settings.alignment]}`:o.legend&&(r+="|"),o.legend&&(r+=`||${o.legend}`),r+="))",o.link){const t=dotclear.mm_select.img_link_title?`||${e(dotclear.mm_select.img_link_title)}`:"";return`[${r}|${s.stripBaseURL(n.url)}${t}]\n`}return`${r}\n`})})},jsToolBar.prototype.elements.mm_select.fncall.xhtml=function(){const{data:s}=this.elements.mm_select;if(void 0===s||0===s.list.length)return;dotclear.mm_select.getInfos(s.path,s.list,s.pref,this,(s,l)=>{if(l.settings?.block){const e=l.settings.block+(l.settings?.class?` class="${l.settings?.class}"`:"");s.encloseSelection(`<${e}>\n`,`</${l.settings.block}>\n`)}for(const n of Object.values(l.list))s.encloseSelection("","",i=>{const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:i,alt:n?.title,description:n?.description,link:l.settings?.link});let r=`<img src="${s.stripBaseURL(n.src)}" alt="${o.alt}"`,a="<figure";const m=o.legend?`<figcaption>${o.legend}</figcaption>\n`:"";if(l.settings.alignment in c&&(o.legend?a=`${a} class="${c[l.settings.alignment]}"`:r=`${r} class="${c[l.settings.alignment]}"`),r=`${r}>`,a=`${a}>`,o.link){const t=dotclear.mm_select.img_link_title?`title="${e(dotclear.mm_select.img_link_title)}"`:"";r=`<a href="${s.stripBaseURL(n.url)}"${t}>${r}</a>`}return o.legend?`${a}\n${r}\n${m}</figure>\n`:`${r}\n`})})},jsToolBar.prototype.elements.mm_select.fncall.wysiwyg=function(){const{data:s}=this.elements.mm_select;if(void 0===s||0===s.list.length)return;dotclear.mm_select.getInfos(s.path,s.list,s.pref,this,(s,l)=>{let n;l.settings?.block&&(n=s.iwin.document.createElement(l.settings.block),l.settings?.class&&n.setAttribute("class",l.settings?.class));for(const i of Object.values(l.list).reverse()){if(void 0===i.src)return;const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:str,alt:i?.title,description:i?.description,link:l.settings?.link}),r=o.legend?s.iwin.document.createElement("figure"):null,a=s.iwin.document.createElement("img"),m=o.legend?r:a;if(l.settings.alignment in c&&m.classList.add(c[l.settings.alignment]),a.src=s.stripBaseURL(i.src),a.setAttribute("alt",o.alt),o.legend){const e=s.iwin.document.createElement("figcaption");e.appendChild(s.iwin.document.createTextNode(o.legend)),r.appendChild(a),r.appendChild(e)}if(o.link){const t=dotclear.mm_select.img_link_title?e(dotclear.mm_select.img_link_title):"",l=s.iwin.document.createElement("a");return l.href=s.stripBaseURL(i.url),l.setAttribute("title",t),l.appendChild(m),void(void 0===n?s.insertNode(l):n.insertNode(l))}void 0===n?s.insertNode(m):n.insertNode(m)}void 0!==n&&s.insertNode(n)})},jsToolBar.prototype.elements.mm_select.fncall.markdown=function(){const{data:s}=this.elements.mm_select;if(void 0===s||0===s.list.length)return;dotclear.mm_select.getInfos(s.path,s.list,s.pref,this,(s,l)=>{if(l.settings?.block){const e=l.settings.block+(l.settings?.class?` class="${l.settings?.class}"`:"");s.encloseSelection(`<${e}>\n`,`</${l.settings.block}>\n`)}for(const n of Object.values(l.list))s.encloseSelection("","",i=>{const c={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},o=t({selection:i,alt:n?.title,description:n?.description,link:l.settings?.link});let r=`<img src="${s.stripBaseURL(n.src)}" alt="${o.alt}"`,a="<figure";const m=o.legend?`<figcaption>${o.legend}</figcaption>\n`:"";if(l.settings.alignment in c&&(o.legend?a=`${a} ${dotclear.mm_select.style.class?"class":"style"}="${c[l.settings.alignment]}"`:r=`${r} ${dotclear.mm_select.style.class?"class":"style"}="${c[l.settings.alignment]}"`),r=`${r}>`,a=`${a}>`,o.link){const t=dotclear.mm_select.img_link_title?e(dotclear.mm_select.img_link_title):"",l=t?`title="${t}"`:"";r=`<a href="${s.stripBaseURL(n.url)}"${l}>${r}</a>`}return o.legend?`${a}\n${r}\n${m}</figure>\n`:`${r}\n`})})},jsToolBar.prototype.elements.mm_select.title=dotclear.mm_select.title,dotclear.mm_select.getInfos=(e,t,s,l,n)=>(dotclear.jsonServicesPost("getMediaInfos",e=>{e.ret&&n(l,e.info)},{path:e,list:JSON.stringify(t),pref:JSON.stringify(s)}),null)});
