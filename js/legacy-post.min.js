"use strict";$((()=>{dotclear.mm_select=dotclear.getData("mm_select"),jsToolBar.prototype.elements.mm_select={type:"button",title:"Multiple image chooser",context:"post",icon:dotclear.mm_select.icon,fn:{},fncall:{},open_url:dotclear.mm_select.open_url,data:{},popup(){window.the_toolbar=this,this.elements.mm_select.data={},window.open(this.elements.mm_select.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.mm_select.fn.wiki=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.xhtml=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.wysiwyg=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fn.markdown=function(){this.elements.mm_select.popup.call(this)},jsToolBar.prototype.elements.mm_select.fncall.wiki=function(){const{data:e}=this.elements.mm_select;if(void 0===e||0===e.list.length)return;dotclear.mm_select.getInfos(e.path,e.list,e.pref,this,((e,t)=>{if(t.settings?.block){const l=t.settings.block+(t.settings?.class?` class="${t.settings?.class}"`:"");e.encloseSelection(`///html\n<${l}>\n///\n`,`///html\n</${t.settings.block}>\n///\n`)}Object.values(t.list).forEach((l=>{e.encloseSelection("","",(s=>{const n=(s||l.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let c=!(""===l.description||!n.length)&&l.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");n===c&&(c=!1);let i=`((${e.stripBaseURL(l.src)}|${n}`;return"left"==t.settings.alignment?i+="|L":"right"==t.settings.alignment?i+="|R":"center"==t.settings.alignment?i+="|C":c&&(i+="|"),c&&(i+="|",i+=`|${c}`),i+="))",t.settings.link&&n.length?`[${i}|${e.stripBaseURL(l.url)}${dotclear.mm_select.img_link_title?`||${dotclear.mm_select.img_link_title}`:""}]`:`${i}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.fncall.xhtml=function(){const{data:e}=this.elements.mm_select;if(void 0===e||0===e.list.length)return;dotclear.mm_select.getInfos(e.path,e.list,e.pref,this,((e,t)=>{if(t.settings?.block){const l=t.settings.block+(t.settings?.class?` class="${t.settings?.class}"`:"");e.encloseSelection(`<${l}>\n`,`</${t.settings.block}>\n`)}Object.values(t.list).forEach((l=>{e.encloseSelection("","",(s=>{const n={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},c=(s||l.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let i=!(""===l.description||!c.length)&&l.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");c===i&&(i=!1);let a=`<img src="${e.stripBaseURL(l.src)}" alt="${c}"`,o="<figure";const r=i?`<figcaption>${i}</figcaption>\n`:"";if(t.settings.alignment in n&&(i?o=`${o} class="${n[t.settings.alignment]}"`:a=`${a} class="${n[t.settings.alignment]}"`),a=`${a}>`,o=`${o}>`,t.settings.link&&c.length){const t=dotclear.mm_select.img_link_title?` title="${dotclear.mm_select.img_link_title.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;")}"`:"";a=`<a href="${e.stripBaseURL(l.url)}"${t}>${a}</a>`}return i?`${o}\n${a}\n${r}</figure>\n`:`${a}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.fncall.wysiwyg=function(){const{data:e}=this.elements.mm_select;if(void 0===e||0===e.list.length)return;dotclear.mm_select.getInfos(e.path,e.list,e.pref,this,((e,t)=>{let l;t.settings?.block&&(l=e.iwin.document.createElement(t.settings.block),t.settings?.class&&l.setAttribute("class",t.settings?.class)),Object.values(t.list).reverse().forEach((s=>{if(null==s.src)return;const n={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},c=(e.getSelectedText()?e.getSelectedText():s.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let i=!(""===s.description||!c.length)&&s.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");c===i&&(i=!1);const a=i?e.iwin.document.createElement("figure"):null,o=e.iwin.document.createElement("img"),r=i?a:o;if(t.settings.alignment in n&&r.classList.add(n[t.settings.alignment]),o.src=e.stripBaseURL(s.src),o.setAttribute("alt",c),i){const t=e.iwin.document.createElement("figcaption");t.appendChild(e.iwin.document.createTextNode(i)),a.appendChild(o),a.appendChild(t)}if(t.settings.link&&c.length){const t=c?dotclear.mm_select.img_link_title.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;"):"",n=e.iwin.document.createElement("a");n.href=e.stripBaseURL(s.url),n.setAttribute("title",t),n.appendChild(r),void 0===l?e.insertNode(n):l.insertNode(n)}else void 0===l?e.insertNode(r):l.insertNode(r)})),void 0!==l&&e.insertNode(l)}))},jsToolBar.prototype.elements.mm_select.fncall.markdown=function(){const{data:e}=this.elements.mm_select;if(void 0===e||0===e.list.length)return;dotclear.mm_select.getInfos(e.path,e.list,e.pref,this,((e,t)=>{if(t.settings?.block){const l=t.settings.block+(t.settings?.class?` class="${t.settings?.class}"`:"");e.encloseSelection(`<${l}>\n`,`</${t.settings.block}>\n`)}Object.values(t.list).forEach((l=>{e.encloseSelection("","",(s=>{const n={left:dotclear.mm_select.style.left,right:dotclear.mm_select.style.right,center:dotclear.mm_select.style.center},c=(s||l.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let i=!(""===l.description||!c.length)&&l.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");c===i&&(i=!1);let a=`<img src="${e.stripBaseURL(l.src)}" alt="${c}"`,o="<figure";const r=i?`<figcaption>${i}</figcaption>\n`:"";if(t.settings.alignment in n&&(i?o=`${o} ${dotclear.mm_select.style.class?"class":"style"}="${n[t.settings.alignment]}"`:a=`${a} ${dotclear.mm_select.style.class?"class":"style"}="${n[t.settings.alignment]}"`),a=`${a}>`,o=`${o}>`,t.settings.link&&c.length){const t=c?` title="${dotclear.mm_select.img_link_title.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;")}"`:"";a=`<a href="${e.stripBaseURL(l.url)}"${t}>${a}</a>`}return i?`${o}\n${a}\n${r}</figure>\n`:`${a}\n`}))}))}))},jsToolBar.prototype.elements.mm_select.title=dotclear.mm_select.title,dotclear.mm_select.getInfos=(e,t,l,s,n)=>(t=JSON.stringify(t),l=JSON.stringify(l),dotclear.jsonServicesPost("getMediaInfos",(e=>{e.ret&&n(s,e.info)}),{path:e,list:t,pref:l}),null)}));
